# NVIDIA RTX 3060 Installation


## 1. Pre-Flight

1. Complete all other optimizations - middleware, manual, script.
1. [Download the NVIDIA Studio Driver branch](https://www.nvidia.com/en-us/drivers/).

**IMPORTANT** Do not use `Game Ready` drivers. Specifically, DaVinci Resolve 19 has severe conflict issues with certain recent drivers. 


## 2. Suspend BitLocker

The GPU is tied to the TPM security chip. If we install it without suspending BitLocker, Windows will lock us out and demand a 48-digit recovery key upon reboot.

When you use the GUI to suspend BitLocker, it will auto-restart on the next boot - we don't want this. These steps permanently suspend BitLocker until we're confident the new GPU is working. 

1. Start > Manage BitLocker: Back up your recovery key

2. Check BitLocker status and protection level: 

```PowerShell
# Check 
manage-bde -status C:

# Result
BitLocker Drive Encryption: Configuration Tool version 10.0.26100
Copyright (C) 2013 Microsoft Corporation. All rights reserved.

Volume C: [OS]
[OS Volume]

Size:                 453.77 GB
BitLocker Version:    2.0
Conversion Status:    Used Space Only Encrypted
Percentage Encrypted: 100.0%
Encryption Method:    XTS-AES 128
Protection Status:    Protection On
Lock Status:          Unlocked
Identification Field: Unknown
Key Protectors:
    TPM
    Numerical Password

```

3. Suspend BitLocker and check:

```PowerShell
# 1. Suspend BitLocker indefinitely (RebootCount 0)
Suspend-BitLocker -MountPoint "C:" -RebootCount 0

# 2. Verify Protection Status = Protection Off
manage-bde -status C:

# 3. Reboot PC and check still Off
manage-bde -status C:

```

## 3. Disable Driver Searching and Enter Safe Mode

These steps prevent Windows from interfering with manual driver installation later. First, confirm Windows keys: 

```PowerShell
# 1. Confirm this exists: 
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverSearching"
Get-ItemProperty -Path $Reg_Path | Select-Object * -ExcludeProperty ps*

SearchOrderConfig = 1

# 2. Confirm this exists: 
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Device Metadata"
Get-ItemProperty -Path $Reg_Path | Select-Object * -ExcludeProperty ps*

CheckBackMDNotRetrieved = 5
CheckBackMDRetrieved = 8
PreventDeviceMetadataFromNetwork = 0

```

Then temporarily configure: 

```Powershell
# 1. Block Windows Update from auto-installing generic drivers
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverSearching"
Set-ItemProperty -Path $Reg_Path -Name "SearchOrderConfig" -Value 0

# 2. Block Device Metadata networking (Prevents background driver scans)
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Device Metadata"
Set-ItemProperty -Path $Reg_Path -Name "PreventDeviceMetadataFromNetwork" -Value 1

# 3. Force next boot into Safe Mode with Networking
bcdedit /set {current} safeboot network

```

## 4. Physical Installation

1. Shut down the workstation and remove the power cable.
1. Press and hold the power button for 10 seconds to discharge flea power.
1. Install the RTX card into the primary PCIe x16 slot.
1. Use individual power cables from the power supply to each port on the GPU.
1. Do not use pigtail or splitter cables to avoid voltage drops during renders.
1. Reassemble the chassis and connect the display to the RTX card Display1.


## 5. BIOS Configuration

**NOTE** PC will boot in Safe Mode per step 3. 

1. Power on. F2 to enter BIOS.

1. Disable Secure Boot to prevent firmware signature mismatches with the moved GPU. This will be re-enabled post GPU: 

    - Boot Configuration > Secure Boot = Off [On]

1. Disable DMA Protection to prevent the OS from sandboxing the GPU, which can cause micro-stutters during heavy VRAM usage. These will remain off permanently:  

    - Virtualization Support > Enable Pre-Boot DMA Support = Off [On]
    - Virtualization Support > Enable OS Kernel DMA Support = Off [On] 
    - Virtualization Support > Internal Port DMA Compatibility Mode = [Disabled]

1. Enable BAR to allow the Intel Core Ultra 7 265K to access the entire GPU frame buffer. This should already be on: 

    - Performance > PCIe Resizable Base Address Register (BAR) = [On]

1. Save the settings and exit the BIOS to boot into Windows.


## 6. Validate Hardware

Before installing drivers, confirm the system has successfully negotiated with the foreign hardware.

```PowerShell
# 1. Check the status of the new display adapter
Get-PnpDevice -Class Display | Select-Object FriendlyName, Status, InstanceId

# Expect something like: 
Field           Expected Result                     Meaning
FriendlyName    Microsoft Basic Display Adapter     The hardware is detected but has no driver yet.
Status          OK                                  The BIOS and PCIe bus have successfully initialized the card.
Status          Error                               Hardware rejection or power cable issue. Check BIOS DMA settings.

# 2. Confirm Kernel DMA Protection is inactive
Get-ComputerInfo | Select-Object DeviceGuardSmartSyncProtectionStatus

# Expect something like:
Result  Status      Action
Off     Success     The GPU has direct, un-throttled access to system memory.
On      Failed      Re-visit BIOS > Virtualization > Enable OS Kernel DMA Support.

```

## 7. Install Drivers

Perform a clean install to wipe the previous hardware profile and reset the NVIDIA Display Container service. This is critical because the optimization scripts target specific registry paths that only exist after a clean init.

1. Select Custom (Advanced) installation.
1. Check the box for Perform a clean installation.

Confirm Resizable BAR:

1. Launch NVIDIA Control Panel
1. Click System Information (bottom-left corner).
1. Check Resizable BAR = Yes.


## 8. Restore Driver Searching and Exit Safe Mode

```PowerShell
# 1. Un-Block Windows Update 
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\DriverSearching"
Set-ItemProperty -Path $Reg_Path -Name "SearchOrderConfig" -Value 1

# 2. Un-Block Device Metadata networking 
$Reg_Path = "HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Device Metadata"
Set-ItemProperty -Path $Reg_Path -Name "PreventDeviceMetadataFromNetwork" -Value 0

# 3. Remove Safe Mode boot flag
bcdedit /deletevalue {current} safeboot

```

## 9. Re-Enable Secure Boot

1. Restart. F2 to enter BIOS.
1. Boot Configuration > Secure Boot = [On]
1. Save and Exit to boot to Windows.
1. Validate Secure Boot is back on:

```PowerShell
# Check security features status
Get-ComputerInfo | Select-Object DeviceGuardSmartSyncProtectionStatus, SecureBootStatus

```

## 10. Un-Suspend BitLocker

```PowerShell
# 1. Resume BitLocker protection
Resume-BitLocker -MountPoint "C:"

# 2. Restart

# 3. Verify Protection Status = Protection On
manage-bde -status C:

```

## 11. NVIDIA Control Panel

| Setting                     | Target Value               | Why?     |
| --------------------------- | -------------------------- | -------- |
| Power management mode       | Prefer maximum performance | Keeps GPU clocks high to prevent laggy playback during color work. |
| Texture filtering - Quality | High performance           | Bypasses redundant driver filtering to speed up frame processing.  |
| Threaded optimization       | On                         | Improves communication between Arrow lake CPU and the GPU.|
| Vertical sync               | Off                        | Prevents the 60fps cap; essential for smooth Fusion UI responsiveness. |
| Low Latency Mode            | On                         | Reduces the render queue to make timeline scrubbing feel instant. |
| Open GL GDI compatibility   | Prefer Performance         | Accelerates 2D UI overlays on top of 3D viewports. |
| Multi-Frame Sampled AA      | Off                        | Prevents artificial smoothing that can mask noise or render artifacts. |
| Background Application Max Frame Rate | Off              | Ensures background renders (Resolve/Media Encoder) run at full speed.  |
| Output color format         | RGB                        | Ensures the most accurate color reproduction for PC monitors. |
| Output color depth          | 10 bpc (if avail)          | Critical for 10-bit grading in Resolve to prevent banding.    |
| Output dynamic range        | Full (0-255)               | Fixes the gamma shift bug where blacks appear as dark grey. |

**Viewport Stutter:** If the `G-Sync` or `Variable Refresh` Rate is active in Windows Graphics settings, Substance viewports can flicker. Force `Fixed Refresh` for Substance in the NVIDIA Control Panel.

